{
    "thread": 5,
    "name": "taobaoqiyeinfo",
    "collection": "taobaoshoplist",
    "filter": {
        "type": "simple"
    },
    "seed_generator": {
        "keep": true,
        "find": {
            "ref": {
                "isQiye": "1",
                "crawlCompany" : { "$exists" : false},
                "shopClose" : { "$exists" : false}
            },
            "keys": {
                "userid": 1,
                "_link": 1
            },
            "limit": 1000
        },
        "url": "https://s.taobao.com/api?sid={{userid}}&callback=shopcard&app=api&m=get_shop_card",
        "processor": "shopcard"
    },
    "queue": {
        "suport_priority": true
    },
    "processors": [
        {
            "index": "shopcard",
            "page_context": {
                "shopcard_data": {
                    "_type": "json",
                    "shopUrl": "url",
                    "dsr":{
                        "favorableRate":"favorableRate",
                        "matchDescription":"matchDescription",
                        "serviceAttitude":"serviceAttitude",
                        "deliverySpeed":"deliverySpeed",
                        "descriptionCompared":"descriptionCompared",
                        "attitudeCompared":"attitudeCompared",
                        "deliveryCompared":"deliveryCompared"
                    }
                }
            },
            "crawler_request": [
                {
                    "_condition":"{{existKey n \"shopcard_data.shopUrl\"}}",
                    "_datacontext": {
                        "key": "shopcard_data",
                        "data_flow": true
                    },
                    "url": "{{shopUrl}}/company.htm",
                    "processor": "py_company",
                    "priority": 2
                }
            ],
            "crawler_data":[
                {
                    "_condition":"{{isEmpty n \"shopcard_data.shopUrl\"}}",
                    "_update": {
                        "userid": "{{userid}}"
                    },
                    "shopClose":"true{{nil}}"
                }
            ]
        },
        {
            "index": "py_company",
            "crawler_data": [
                {
                    "_update": {
                        "userid": "{{userid}}"
                    },
                    "shopId": ";html;shopId\":\"(\\d+)",
                    "sellerBail": ".tb-seller-bail",
                    "createShop": ";html;创店时间：([^<]+)",
                    "credite": ";html;卖家信用：(\\d+)",
                    "businessType": ";html;经营类型：([^<]+)",
                    "licenseNumber": ";html;营业执照注册号：([^<]+)",
                    "phone": ";html;联系电话：([^<]+)<",
                    "profile": ".archive-main:contains('公司简介') div[class='bd clearfix']",
                    "crawlCompany":"true{{nil}}"
                }
            ]
        }
    ]
}